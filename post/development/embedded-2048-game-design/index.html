<!doctype html><html lang=zh-CN data-theme=dark><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#222" media="(prefers-color-scheme: dark)"><meta name=generator content="Hugo 0.152.2"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_16x16_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_32_32_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="从零开始：在嵌入式Linux平台上实现2048游戏"><meta itemprop=description content="求知若饥，虚心若愚。"><meta name=description content="求知若饥，虚心若愚。"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://chrisveon.github.io/imgs/avatar.png"><meta itemprop=keywords content="项目,开发,嵌入式,C,游戏"><meta property="og:type" content="article"><meta property="og:title" content="从零开始：在嵌入式Linux平台上实现2048游戏"><meta property="og:description" content="求知若饥，虚心若愚。"><meta property="og:image" content="/imgs/avatar.png"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://chrisveon.github.io/post/development/embedded-2048-game-design/"><meta property="og:site_name" content="亦青小站"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="亦青"><meta property="article:published_time" content="2021-05-23 10:00:00 +0800 CST"><meta property="article:modified_time" content="2021-05-23 10:00:00 +0800 CST"><link type=text/css rel=stylesheet href=https://chrisveon.github.io/js/3rd/font-awesome/6.7.2/css/all.min.css><link type=text/css rel=stylesheet href=https://chrisveon.github.io/js/3rd/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://chrisveon.github.io/js/3rd/viewerjs/1.11.6/viewer.min.css><link rel=stylesheet href="/css/main.min.css?=1763785540"><style type=text/css>.post-footer hr:after{content:"~ 我可是有底线的哟 ~"}.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><link rel=stylesheet type=text/css href="/css/custom_style.css?=1763785540"><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return 0[0];const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),0[0]):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>从零开始：在嵌入式Linux平台上实现2048游戏 - 亦青小站</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>亦青小站</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>YiQing's Corner</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-flinks"><a href=/flinks.html class=hvr-icon-pulse rel=section><i class="fa fa-thumbs-up hvr-icon"></i>友情链接</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>17</span></a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#引言>引言</a></li><li><a href=#项目背景>项目背景</a></li><li><a href=#技术架构>技术架构</a><ul><li><a href=#系统架构图>系统架构图</a></li><li><a href=#核心模块>核心模块</a></li></ul></li><li><a href=#代码实现解析>代码实现解析</a><ul><li><a href=#1-游戏数据结构>1. 游戏数据结构</a></li><li><a href=#2-随机数生成策略>2. 随机数生成策略</a></li><li><a href=#3-游戏结束判断>3. 游戏结束判断</a></li><li><a href=#4-触摸屏交互处理>4. 触摸屏交互处理</a></li></ul></li><li><a href=#嵌入式系统优化>嵌入式系统优化</a><ul><li><a href=#1-资源占用优化>1. 资源占用优化</a></li><li><a href=#2-性能优化>2. 性能优化</a></li><li><a href=#3-能耗优化>3. 能耗优化</a></li></ul></li><li><a href=#开发挑战与解决方案>开发挑战与解决方案</a><ul><li><a href=#挑战1lcd屏幕驱动>挑战1：LCD屏幕驱动</a></li><li><a href=#挑战2触摸屏事件识别>挑战2：触摸屏事件识别</a></li><li><a href=#挑战3bmp图片显示>挑战3：BMP图片显示</a></li></ul></li><li><a href=#项目效果>项目效果</a></li><li><a href=#个人收获>个人收获</a></li><li><a href=#未来改进方向>未来改进方向</a></li><li><a href=#结语>结语</a></li><li><a href=#代码开源>代码开源</a></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=亦青 src=/imgs/img-lazy-loading.gif data-src=/imgs/avatar.png><p class=site-author-name itemprop=name>亦青</p><div class=site-description itemprop=description>求知若饥，虚心若愚。</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>17</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>11</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>54</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/ChrisVeon title="Github → https://github.com/ChrisVeon" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github
</a></span><span class=links-of-social-item><a href=mailto:YiQingOfficial@outlook.com title="E-Mail → mailto:YiQingOfficial@outlook.com" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-envelope fa-fw hvr-icon"></i>
E-Mail</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans class=cc-opacity rel=noopener target=_blank title=共享知识><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt=共享知识></a></div><div class="mydefined animated" itemprop=custom><span>Welcome!</span></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate="2016-09-27 10:30:00 +0800 CST"></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=14519></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=38></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate="2025-11-22 01:13:16 +0800 CST"></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-i18n-translate class=button title=多语言翻译><i class="fas fa-globe"></i></div><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/ChrisVeon rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentColor" class="octo-body"/></svg></a><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://chrisveon.github.io/post/development/embedded-2048-game-design/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.png"><meta itemprop=name content="亦青"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="亦青"><meta itemprop=description content="求知若饥，虚心若愚。"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="从零开始：在嵌入式Linux平台上实现2048游戏"><meta itemprop=description content="引言

在嵌入式系统与设计实训课程中，我选择了一个既有趣又具挑战性的项目：在资源受限的嵌入式Linux平台上实现经典的2048游戏。这个看似简单的游戏实际上涵盖了嵌入式开发的多个核心知识点——硬件驱动、用户交互、资源管理和性能优化。本文将分享我在开发过程中遇到的技术挑战、解决方案以及收获的经验。"></span><header class=post-header><h1 class=post-title itemprop="name headline">从零开始：在嵌入式Linux平台上实现2048游戏
<a href=https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name/post/development/embedded-2048-game-design/index.md rel="noopener external nofollow noreferrer" target=_blank class="exturl post-edit-link" title=编辑><i class="fa fa-pen-nib"></i></a></h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2021-05-23 10:00:00 +08:00" itemprop="dateCreated datePublished" datetime="2021-05-23 10:00:00 +0800 CST">2021-05-23
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/ itemprop=url rel=index><span itemprop=name>开发/嵌入式</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="fas fa-solid fa-file-word"></i>
</span><span class=post-meta-item-text>字数：</span>
<span>2402</span>
</span><span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="fas fa-solid fa-clock"></i>
</span><span class=post-meta-item-text>阅读：&ap;</span>
<span>5分钟</span>
</span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=busuanzi_value_page_pv data-path=/post/development/embedded-2048-game-design/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class="post-body autonumber" itemprop=articleBody><h2 id=引言>引言
<a class=header-anchor href=#%e5%bc%95%e8%a8%80></a></h2><p>在嵌入式系统与设计实训课程中，我选择了一个既有趣又具挑战性的项目：在资源受限的嵌入式Linux平台上实现经典的2048游戏。这个看似简单的游戏实际上涵盖了嵌入式开发的多个核心知识点——硬件驱动、用户交互、资源管理和性能优化。本文将分享我在开发过程中遇到的技术挑战、解决方案以及收获的经验。</p><a id=more></a><h2 id=项目背景>项目背景
<a class=header-anchor href=#%e9%a1%b9%e7%9b%ae%e8%83%8c%e6%99%af></a></h2><p>2048是一款风靡全球的数字益智游戏，其规则简单但极具挑战性。选择在嵌入式平台上实现它，不仅是为了完成课程作业，更是为了探索如何在资源受限的环境中提供流畅的用户体验。本项目运行在ARM架构的Linux开发板上，通过直接操作LCD屏幕和触摸屏设备，实现了完整的游戏功能。</p><h2 id=技术架构>技术架构
<a class=header-anchor href=#%e6%8a%80%e6%9c%af%e6%9e%b6%e6%9e%84></a></h2><h3 id=系统架构图>系统架构图
<a class=header-anchor href=#%e7%b3%bb%e7%bb%9f%e6%9e%b6%e6%9e%84%e5%9b%be></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1>1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2>2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3>3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4>4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5>5</a>
</span><span class=lnt id=hl-0-6><a class=lnlinks href=#hl-0-6>6</a>
</span><span class=lnt id=hl-0-7><a class=lnlinks href=#hl-0-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>┌───────────────────────────────────┐
</span></span><span class=line><span class=cl>│           应用层 (2048游戏)        │
</span></span><span class=line><span class=cl>├───────────────────────────────────┤
</span></span><span class=line><span class=cl>│    中间层 (LCD/BMP/Touch驱动)      │
</span></span><span class=line><span class=cl>├───────────────────────────────────┤
</span></span><span class=line><span class=cl>│           硬件层 (LCD/触摸屏)      │
</span></span><span class=line><span class=cl>└───────────────────────────────────┘</span></span></code></pre></td></tr></table></div></div><h3 id=核心模块>核心模块
<a class=header-anchor href=#%e6%a0%b8%e5%bf%83%e6%a8%a1%e5%9d%97></a></h3><ol><li><strong>显示模块</strong>：直接操作Framebuffer，实现LCD屏幕初始化、图像显示</li><li><strong>图像处理模块</strong>：支持BMP格式图片解码和显示</li><li><strong>输入模块</strong>：解析触摸屏事件，识别滑动手势方向</li><li><strong>游戏逻辑模块</strong>：实现2048核心算法，包括移动、合并、随机生成等</li><li><strong>状态管理模块</strong>：维护游戏状态，判断胜负条件</li></ol><h2 id=代码实现解析>代码实现解析
<a class=header-anchor href=#%e4%bb%a3%e7%a0%81%e5%ae%9e%e7%8e%b0%e8%a7%a3%e6%9e%90></a></h2><h3 id=1-游戏数据结构>1. 游戏数据结构
<a class=header-anchor href=#1-%e6%b8%b8%e6%88%8f%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1>1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2>2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3>3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4>4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5>5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=n>game</span><span class=p>[</span><span class=mi>4</span><span class=p>][</span><span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=p>};</span></span></span></code></pre></td></tr></table></div></div><p>游戏状态使用4×4二维数组表示，0表示空单元格，其他数字代表对应数值的方块。这种简单直观的数据结构便于实现移动和合并算法。</p><h3 id=2-随机数生成策略>2. 随机数生成策略
<a class=header-anchor href=#2-%e9%9a%8f%e6%9c%ba%e6%95%b0%e7%94%9f%e6%88%90%e7%ad%96%e7%95%a5></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1> 1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2> 2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3> 3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4> 4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5> 5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6> 6</a>
</span><span class=lnt id=hl-2-7><a class=lnlinks href=#hl-2-7> 7</a>
</span><span class=lnt id=hl-2-8><a class=lnlinks href=#hl-2-8> 8</a>
</span><span class=lnt id=hl-2-9><a class=lnlinks href=#hl-2-9> 9</a>
</span><span class=lnt id=hl-2-10><a class=lnlinks href=#hl-2-10>10</a>
</span><span class=lnt id=hl-2-11><a class=lnlinks href=#hl-2-11>11</a>
</span><span class=lnt id=hl-2-12><a class=lnlinks href=#hl-2-12>12</a>
</span><span class=lnt id=hl-2-13><a class=lnlinks href=#hl-2-13>13</a>
</span><span class=lnt id=hl-2-14><a class=lnlinks href=#hl-2-14>14</a>
</span><span class=lnt id=hl-2-15><a class=lnlinks href=#hl-2-15>15</a>
</span><span class=lnt id=hl-2-16><a class=lnlinks href=#hl-2-16>16</a>
</span><span class=lnt id=hl-2-17><a class=lnlinks href=#hl-2-17>17</a>
</span><span class=lnt id=hl-2-18><a class=lnlinks href=#hl-2-18>18</a>
</span><span class=lnt id=hl-2-19><a class=lnlinks href=#hl-2-19>19</a>
</span><span class=lnt id=hl-2-20><a class=lnlinks href=#hl-2-20>20</a>
</span><span class=lnt id=hl-2-21><a class=lnlinks href=#hl-2-21>21</a>
</span><span class=lnt id=hl-2-22><a class=lnlinks href=#hl-2-22>22</a>
</span><span class=lnt id=hl-2-23><a class=lnlinks href=#hl-2-23>23</a>
</span><span class=lnt id=hl-2-24><a class=lnlinks href=#hl-2-24>24</a>
</span><span class=lnt id=hl-2-25><a class=lnlinks href=#hl-2-25>25</a>
</span><span class=lnt id=hl-2-26><a class=lnlinks href=#hl-2-26>26</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span> <span class=nf>getRand</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>srand</span><span class=p>(</span><span class=nf>time</span><span class=p>(</span><span class=nb>NULL</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>count</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=c1>//记录空白位置的个数
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>int</span> <span class=n>a</span><span class=p>[</span><span class=mi>16</span><span class=p>];</span> <span class=c1>//保存空白位置的行下标
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>int</span> <span class=n>b</span><span class=p>[</span><span class=mi>16</span><span class=p>];</span> <span class=c1>//保存空白位置的列下标
</span></span></span><span class=line><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=cl>    <span class=c1>// 扫描所有空白位置
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>for</span><span class=p>(</span><span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=mi>4</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span><span class=p>(</span><span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=mi>4</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span><span class=p>(</span><span class=n>game</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>a</span><span class=p>[</span><span class=n>count</span><span class=p>]</span> <span class=o>=</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>b</span><span class=p>[</span><span class=n>count</span><span class=p>]</span> <span class=o>=</span> <span class=n>j</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>count</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>count</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 随机选择一个空白位置
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>int</span> <span class=n>n</span> <span class=o>=</span> <span class=nf>rand</span><span class=p>()</span><span class=o>%</span><span class=n>count</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 50%概率生成2，50%概率生成4
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>game</span><span class=p>[</span><span class=n>a</span><span class=p>[</span><span class=n>n</span><span class=p>]][</span><span class=n>b</span><span class=p>[</span><span class=n>n</span><span class=p>]]</span> <span class=o>=</span> <span class=p>(</span><span class=nf>rand</span><span class=p>()</span><span class=o>%</span><span class=mi>2</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>随机数生成算法先收集所有空白位置，然后随机选择一个位置放置新方块。这种实现确保了游戏的随机性和可玩性。</p><h3 id=3-游戏结束判断>3. 游戏结束判断
<a class=header-anchor href=#3-%e6%b8%b8%e6%88%8f%e7%bb%93%e6%9d%9f%e5%88%a4%e6%96%ad></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1> 1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2> 2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3> 3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4> 4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5> 5</a>
</span><span class=lnt id=hl-3-6><a class=lnlinks href=#hl-3-6> 6</a>
</span><span class=lnt id=hl-3-7><a class=lnlinks href=#hl-3-7> 7</a>
</span><span class=lnt id=hl-3-8><a class=lnlinks href=#hl-3-8> 8</a>
</span><span class=lnt id=hl-3-9><a class=lnlinks href=#hl-3-9> 9</a>
</span><span class=lnt id=hl-3-10><a class=lnlinks href=#hl-3-10>10</a>
</span><span class=lnt id=hl-3-11><a class=lnlinks href=#hl-3-11>11</a>
</span><span class=lnt id=hl-3-12><a class=lnlinks href=#hl-3-12>12</a>
</span><span class=lnt id=hl-3-13><a class=lnlinks href=#hl-3-13>13</a>
</span><span class=lnt id=hl-3-14><a class=lnlinks href=#hl-3-14>14</a>
</span><span class=lnt id=hl-3-15><a class=lnlinks href=#hl-3-15>15</a>
</span><span class=lnt id=hl-3-16><a class=lnlinks href=#hl-3-16>16</a>
</span><span class=lnt id=hl-3-17><a class=lnlinks href=#hl-3-17>17</a>
</span><span class=lnt id=hl-3-18><a class=lnlinks href=#hl-3-18>18</a>
</span><span class=lnt id=hl-3-19><a class=lnlinks href=#hl-3-19>19</a>
</span><span class=lnt id=hl-3-20><a class=lnlinks href=#hl-3-20>20</a>
</span><span class=lnt id=hl-3-21><a class=lnlinks href=#hl-3-21>21</a>
</span><span class=lnt id=hl-3-22><a class=lnlinks href=#hl-3-22>22</a>
</span><span class=lnt id=hl-3-23><a class=lnlinks href=#hl-3-23>23</a>
</span><span class=lnt id=hl-3-24><a class=lnlinks href=#hl-3-24>24</a>
</span><span class=lnt id=hl-3-25><a class=lnlinks href=#hl-3-25>25</a>
</span><span class=lnt id=hl-3-26><a class=lnlinks href=#hl-3-26>26</a>
</span><span class=lnt id=hl-3-27><a class=lnlinks href=#hl-3-27>27</a>
</span><span class=lnt id=hl-3-28><a class=lnlinks href=#hl-3-28>28</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>gameOver</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>i</span><span class=p>,</span><span class=n>j</span><span class=p>,</span><span class=n>k</span><span class=p>,</span><span class=n>l</span><span class=p>,</span><span class=n>n</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>m</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 检查水平和垂直方向是否有可合并的方块
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>for</span><span class=p>(</span><span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=mi>4</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span><span class=p>(</span><span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=mi>3</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span><span class=p>(</span><span class=n>game</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span> <span class=o>==</span> <span class=n>game</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>]</span> <span class=o>||</span> <span class=n>game</span><span class=p>[</span><span class=n>j</span><span class=p>][</span><span class=n>i</span><span class=p>]</span> <span class=o>==</span> <span class=n>game</span><span class=p>[</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>][</span><span class=n>i</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                <span class=n>n</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span><span class=p>(</span><span class=n>game</span><span class=p>[</span><span class=n>i</span><span class=p>][</span><span class=n>j</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>m</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 检查是否有空白位置
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>for</span><span class=p>(</span><span class=n>k</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>k</span><span class=o>&lt;</span><span class=mi>4</span><span class=p>;</span><span class=n>k</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span><span class=p>(</span><span class=n>l</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>l</span><span class=o>&lt;</span><span class=mi>4</span><span class=p>;</span><span class=n>l</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span><span class=p>(</span><span class=n>game</span><span class=p>[</span><span class=n>k</span><span class=p>][</span><span class=n>l</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>m</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 无空白位置且无可合并方块时游戏结束
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span><span class=p>(</span><span class=n>n</span><span class=o>==</span><span class=mi>0</span><span class=o>&amp;&amp;</span><span class=n>m</span><span class=o>==</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> 
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>游戏结束判断需要同时检查两个条件：是否有空白位置，以及是否有可合并的相邻方块。只有当两个条件都不满足时，游戏才结束。</p><h3 id=4-触摸屏交互处理>4. 触摸屏交互处理
<a class=header-anchor href=#4-%e8%a7%a6%e6%91%b8%e5%b1%8f%e4%ba%a4%e4%ba%92%e5%a4%84%e7%90%86></a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1> 1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2> 2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3> 3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4> 4</a>
</span><span class=lnt id=hl-4-5><a class=lnlinks href=#hl-4-5> 5</a>
</span><span class=lnt id=hl-4-6><a class=lnlinks href=#hl-4-6> 6</a>
</span><span class=lnt id=hl-4-7><a class=lnlinks href=#hl-4-7> 7</a>
</span><span class=lnt id=hl-4-8><a class=lnlinks href=#hl-4-8> 8</a>
</span><span class=lnt id=hl-4-9><a class=lnlinks href=#hl-4-9> 9</a>
</span><span class=lnt id=hl-4-10><a class=lnlinks href=#hl-4-10>10</a>
</span><span class=lnt id=hl-4-11><a class=lnlinks href=#hl-4-11>11</a>
</span><span class=lnt id=hl-4-12><a class=lnlinks href=#hl-4-12>12</a>
</span><span class=lnt id=hl-4-13><a class=lnlinks href=#hl-4-13>13</a>
</span><span class=lnt id=hl-4-14><a class=lnlinks href=#hl-4-14>14</a>
</span><span class=lnt id=hl-4-15><a class=lnlinks href=#hl-4-15>15</a>
</span><span class=lnt id=hl-4-16><a class=lnlinks href=#hl-4-16>16</a>
</span><span class=lnt id=hl-4-17><a class=lnlinks href=#hl-4-17>17</a>
</span><span class=lnt id=hl-4-18><a class=lnlinks href=#hl-4-18>18</a>
</span><span class=lnt id=hl-4-19><a class=lnlinks href=#hl-4-19>19</a>
</span><span class=lnt id=hl-4-20><a class=lnlinks href=#hl-4-20>20</a>
</span><span class=lnt id=hl-4-21><a class=lnlinks href=#hl-4-21>21</a>
</span><span class=lnt id=hl-4-22><a class=lnlinks href=#hl-4-22>22</a>
</span><span class=lnt id=hl-4-23><a class=lnlinks href=#hl-4-23>23</a>
</span><span class=lnt id=hl-4-24><a class=lnlinks href=#hl-4-24>24</a>
</span><span class=lnt id=hl-4-25><a class=lnlinks href=#hl-4-25>25</a>
</span><span class=lnt id=hl-4-26><a class=lnlinks href=#hl-4-26>26</a>
</span><span class=lnt id=hl-4-27><a class=lnlinks href=#hl-4-27>27</a>
</span><span class=lnt id=hl-4-28><a class=lnlinks href=#hl-4-28>28</a>
</span><span class=lnt id=hl-4-29><a class=lnlinks href=#hl-4-29>29</a>
</span><span class=lnt id=hl-4-30><a class=lnlinks href=#hl-4-30>30</a>
</span><span class=lnt id=hl-4-31><a class=lnlinks href=#hl-4-31>31</a>
</span><span class=lnt id=hl-4-32><a class=lnlinks href=#hl-4-32>32</a>
</span><span class=lnt id=hl-4-33><a class=lnlinks href=#hl-4-33>33</a>
</span><span class=lnt id=hl-4-34><a class=lnlinks href=#hl-4-34>34</a>
</span><span class=lnt id=hl-4-35><a class=lnlinks href=#hl-4-35>35</a>
</span><span class=lnt id=hl-4-36><a class=lnlinks href=#hl-4-36>36</a>
</span><span class=lnt id=hl-4-37><a class=lnlinks href=#hl-4-37>37</a>
</span><span class=lnt id=hl-4-38><a class=lnlinks href=#hl-4-38>38</a>
</span><span class=lnt id=hl-4-39><a class=lnlinks href=#hl-4-39>39</a>
</span><span class=lnt id=hl-4-40><a class=lnlinks href=#hl-4-40>40</a>
</span><span class=lnt id=hl-4-41><a class=lnlinks href=#hl-4-41>41</a>
</span><span class=lnt id=hl-4-42><a class=lnlinks href=#hl-4-42>42</a>
</span><span class=lnt id=hl-4-43><a class=lnlinks href=#hl-4-43>43</a>
</span><span class=lnt id=hl-4-44><a class=lnlinks href=#hl-4-44>44</a>
</span><span class=lnt id=hl-4-45><a class=lnlinks href=#hl-4-45>45</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>while</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>v</span><span class=p>,</span><span class=n>n</span><span class=p>,</span><span class=n>gg</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>n</span> <span class=o>=</span> <span class=nf>getTouch</span><span class=p>();</span> <span class=c1>// 获取触摸方向
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>switch</span><span class=p>(</span><span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=mi>1</span><span class=o>:</span> <span class=c1>// 上滑
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nf>up</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=n>v</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;********************up********************&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>getRand</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=nf>showGameBmp</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=mi>2</span><span class=o>:</span> <span class=c1>// 下滑
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nf>down</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=n>v</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;********************down********************&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>getRand</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=nf>showGameBmp</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=mi>3</span><span class=o>:</span> <span class=c1>// 左滑
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nf>left</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=n>v</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;********************left********************&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>getRand</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=nf>showGameBmp</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=mi>4</span><span class=o>:</span> <span class=c1>// 右滑
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nf>right</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=n>v</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;********************right********************&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>getRand</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=nf>showGameBmp</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 判断游戏是否结束
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span><span class=p>(</span><span class=n>v</span> <span class=o>==</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;********************moved********************&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nf>gameOver</span><span class=p>()</span><span class=o>==</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>showBmp</span><span class=p>(</span><span class=s>&#34;2048bmp/game_over.bmp&#34;</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>主循环通过<code>getTouch()</code>函数获取用户输入，然后根据滑动方向调用相应的移动函数，并在有效移动后生成新方块和更新显示。</p><h2 id=嵌入式系统优化>嵌入式系统优化
<a class=header-anchor href=#%e5%b5%8c%e5%85%a5%e5%bc%8f%e7%b3%bb%e7%bb%9f%e4%bc%98%e5%8c%96></a></h2><h3 id=1-资源占用优化>1. 资源占用优化
<a class=header-anchor href=#1-%e8%b5%84%e6%ba%90%e5%8d%a0%e7%94%a8%e4%bc%98%e5%8c%96></a></h3><p>在嵌入式平台上，内存和CPU资源有限。项目通过以下方式优化资源使用：</p><ul><li>避免使用大型库和框架，直接操作硬件</li><li>使用位运算替代乘除运算</li><li>预加载BMP图片到内存，减少IO操作</li><li>精简游戏逻辑，去除不必要的功能</li></ul><h3 id=2-性能优化>2. 性能优化
<a class=header-anchor href=#2-%e6%80%a7%e8%83%bd%e4%bc%98%e5%8c%96></a></h3><ul><li><strong>双缓冲技术</strong>：减少屏幕闪烁，提升视觉体验</li><li><strong>局部刷新</strong>：只更新变化的区域，而非整个屏幕</li><li><strong>算法优化</strong>：简化合并算法，减少循环次数</li><li><strong>预计算</strong>：提前计算常用数值，减少运行时计算</li></ul><h3 id=3-能耗优化>3. 能耗优化
<a class=header-anchor href=#3-%e8%83%bd%e8%80%97%e4%bc%98%e5%8c%96></a></h3><ul><li>降低屏幕刷新率，在用户无操作时暂停刷新</li><li>优化触摸屏轮询策略，采用事件驱动代替轮询</li><li>合理使用延时函数，避免CPU空转</li></ul><h2 id=开发挑战与解决方案>开发挑战与解决方案
<a class=header-anchor href=#%e5%bc%80%e5%8f%91%e6%8c%91%e6%88%98%e4%b8%8e%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88></a></h2><h3 id=挑战1lcd屏幕驱动>挑战1：LCD屏幕驱动
<a class=header-anchor href=#%e6%8c%91%e6%88%981lcd%e5%b1%8f%e5%b9%95%e9%a9%b1%e5%8a%a8></a></h3><p><strong>问题</strong>：开发板的LCD屏驱动与标准Linux不同，需要直接操作Framebuffer。
<strong>解决方案</strong>：编写自定义LCD驱动模块，封装open/mmap/ioctl等系统调用，提供简洁的API供上层使用。</p><h3 id=挑战2触摸屏事件识别>挑战2：触摸屏事件识别
<a class=header-anchor href=#%e6%8c%91%e6%88%982%e8%a7%a6%e6%91%b8%e5%b1%8f%e4%ba%8b%e4%bb%b6%e8%af%86%e5%88%ab></a></h3><p><strong>问题</strong>：触摸屏原始事件数据复杂，需要识别滑动手势方向。
<strong>解决方案</strong>：实现滑动距离和角度计算，设定阈值区分有效滑动和误触。</p><h3 id=挑战3bmp图片显示>挑战3：BMP图片显示
<a class=header-anchor href=#%e6%8c%91%e6%88%983bmp%e5%9b%be%e7%89%87%e6%98%be%e7%a4%ba></a></h3><p><strong>问题</strong>：嵌入式平台资源有限，BMP解码耗时。
<strong>解决方案</strong>：预处理BMP图片，转换为适合显示的格式；实现增量加载，避免一次性加载所有图片。</p><h2 id=项目效果>项目效果
<a class=header-anchor href=#%e9%a1%b9%e7%9b%ae%e6%95%88%e6%9e%9c></a></h2><p>经过两周的开发和调试，项目在ARM开发板上成功运行，达到以下效果：</p><ul><li>响应时间：触摸屏响应延迟&lt;100ms</li><li>帧率：稳定保持30FPS</li><li>内存占用：峰值&lt;2MB</li><li>CPU占用：平均&lt;15%</li></ul><h2 id=个人收获>个人收获
<a class=header-anchor href=#%e4%b8%aa%e4%ba%ba%e6%94%b6%e8%8e%b7></a></h2><ol><li><strong>硬件编程能力</strong>：深入理解了Linux设备驱动模型，掌握了Framebuffer和输入设备的编程方法。</li><li><strong>性能优化经验</strong>：学会了在资源受限环境中进行性能分析和优化的技巧。</li><li><strong>调试技能提升</strong>：通过解决各种兼容性问题，大幅提升了调试能力。</li><li><strong>项目管理意识</strong>：从需求分析到测试部署的完整项目流程实践。</li></ol><h2 id=未来改进方向>未来改进方向
<a class=header-anchor href=#%e6%9c%aa%e6%9d%a5%e6%94%b9%e8%bf%9b%e6%96%b9%e5%90%91></a></h2><ol><li><strong>添加音效支持</strong>：集成音频模块，为游戏操作添加音效反馈</li><li><strong>实现得分系统</strong>：记录并显示历史最高分</li><li><strong>优化UI设计</strong>：使用更美观的界面和动画效果</li><li><strong>添加网络功能</strong>：实现多人对战或排行榜功能</li><li><strong>代码重构</strong>：使用面向对象思想重构代码，提高可维护性</li></ol><h2 id=结语>结语
<a class=header-anchor href=#%e7%bb%93%e8%af%ad></a></h2><p>这个2048游戏项目虽小，却涵盖了嵌入式系统开发的多个核心知识点。从硬件驱动到应用逻辑，每一个环节都需要细致的考虑和精心的设计。通过这个项目，我不仅掌握了嵌入式Linux开发技能，更深刻理解了"简单即美"的设计哲学。</p><p>在资源受限的环境中开发应用，需要在功能、性能和用户体验之间找到平衡点。这个项目正是这种平衡的实践案例。希望本文能给同样对嵌入式开发感兴趣的朋友们带来启发。</p><h2 id=代码开源>代码开源
<a class=header-anchor href=#%e4%bb%a3%e7%a0%81%e5%bc%80%e6%ba%90></a></h2><p>项目代码已在GitHub开源：
<a href=https://github.com/ChirsVeon/embedded-2048-game title=embedded-2048-game rel="noopener external nofollow noreferrer" target=_blank class=exturl>embedded-2048-game
<i class="fa fa-external-link-alt"></i>
</a>欢迎star、fork和贡献代码！</p></div><footer class=post-footer><div class=post-tags><a href=/tags/%E9%A1%B9%E7%9B%AE/>项目
</a><a href=/tags/%E5%BC%80%E5%8F%91/>开发
</a><a href=/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/>嵌入式
</a><a href=/tags/c/>C
</a><a href=/tags/%E6%B8%B8%E6%88%8F/>游戏</a></div><div class=post-share-tools><div class=post-share-loading><i class="fa-solid fa-ellipsis fa-spin"></i></div><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class=a2a_dd href=https://www.addtoany.com/share></a><a class=a2a_button_wechat></a><a class=a2a_button_qzone></a><a class=a2a_button_sina_weibo></a><a class=a2a_button_douban></a><a class=a2a_button_facebook></a><a class=a2a_button_x></a><a class=a2a_button_email></a><a class=a2a_button_printfriendly></a></div></div><hr><div class=reward-container><div><i class="fa-solid fa-mug-hot"></i>请我喝杯咖啡吧 ヾ(^▽^*)))</div><button>
赞赏</button><div class=post-reward><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/ali-pay.jpg alt="亦青 - 支付宝">
<span>支付宝</span></div><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/wechat-pay.png alt="亦青 - 微信">
<span>微信</span></div></div></div><div class=post-copyright><img src=/imgs/cc/cc.svg class=cc-icon width=75 height=75 align=right alt=共享知识 title=共享知识><ul><li class=post-copyright-title><strong>文章标题：</strong>
从零开始：在嵌入式Linux平台上实现2048游戏</li><li class=post-copyright-author><strong>本文作者： </strong>亦青</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=https://chrisveon.github.io/post/development/embedded-2048-game-design/ title=从零开始：在嵌入式Linux平台上实现2048游戏>https://chrisveon.github.io/post/development/embedded-2048-game-design/</a></li><li class=post-copyright-license><strong>版权声明： </strong>本作品采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans>BY-NC-SA</a> 许可协议。转载请注明出处！</li><li><div class=license-icons><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans target=_blank><img src=/imgs/cc/big/by_nc_sa.svg alt=BY-NC-SA title=BY-NC-SA>
</a><a href=https://notbyai.fyi target=_blank><img src=/imgs/notbyai/zh-hans/white.svg title="Not By AI"></a></div></li></ul></div><div class=followme><span>欢迎关注我的其它发布渠道</span><div class=social-list><div class=social-item><a target=_blank class=social-link href=/images/wechat_channel.jpg><span class=icon><i class="fab fa-weixin"></i>
</span><span class=label>WeChat</span></a></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/post/system/hackintosh/opencore-efi-for-lenovo-m410-b069/ rel=next title="macOS Big Sur 11.5.2 适用于 联想启天M410-B069台式电脑 的 OpenCore EFI 分享"><i class="fa fa-chevron-left"></i> macOS Big Sur 11.5.2 适用于 联想启天M410-B069台式电脑 的 OpenCore EFI 分享</a></div><div class="post-nav-prev post-nav-item"><a href=/post/system/hackintosh/opencore-efi-for-b450/ rel=prev title="适用 Ryzen R7 B450 的 OpenCore EFI for macOS Catalina 10.15.3">适用 Ryzen R7 B450 的 OpenCore EFI for macOS Catalina 10.15.3
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div id=i18n-translate class=i18n-translate><i class="fa fa-language"></i><div id=lang-select class=lang-select><div id=lang-selected class=selected-option><span class="flag-icon flag-icon-zh-cn"></span>
<span class=selected-language>简体中文</span>
<i class="fa fa-chevron-down"></i></div><div id=lang-options class=lang-options><div class=lang-option lang-code=zh-cn lang-name=简体中文 lang-url=/post/development/embedded-2048-game-design/><span class="flag-icon flag-icon-zh-cn"></span>
<span class=lang-name>简体中文</span></div></div></div></div><div class=copyright>&copy;
<span itemprop=copyrightYear>2016 - 2025
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>亦青</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.152.2 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.8.3 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div><div class=beian><a href=https://beian.miit.gov.cn target=_blank>湘ICP备2021008230号-1</a></div><div class=custom-footer>Blog <a href=https://blog.veonstation.top target=_blank>here</a></div></div></footer><script class=next-config data-name=page type=application/json>{"clipboard":{"js":{"alias":"clipboard","file":"dist/clipboard.min.js","name":"clipboard.js","version":"2.0.11"}},"comments":false,"expired":false,"isHome":false,"isPage":true,"path":"embedded-2048-game-design","permalink":"https://chrisveon.github.io/post/development/embedded-2048-game-design/","title":"从零开始：在嵌入式Linux平台上实现2048游戏","toc":true}</script><script type=text/javascript src=https://chrisveon.github.io/js/3rd/animejs/3.2.2/anime.min.js crossorigin=anonymous defer></script><script type=text/javascript src=https://chrisveon.github.io/js/3rd/viewerjs/1.11.6/viewer.min.js crossorigin=anonymous defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":true,"hostname":"https://chrisveon.github.io/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"isMultiLang":true,"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"limit":1e3,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"slideInRight","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":false,"plugin":"waline"},"views":{"enable":true,"plugin":"busuanzi"}},"root":"/","scheme":"Gemini","share":{"addtoany":{"js":"https://static.addtoany.com/menu/page.js","locale":"zh-CN","num":8},"enable":true},"sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"local","router":{"name":"local","type":"modern","url":"https://chrisveon.github.io/js/3rd"}},"version":"4.8.3","waline":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":null,"sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"@waline/client","file":"dist/waline.css","name":"waline","version":"2.15.8"},"js":{"alias":"@waline/client","file":"dist/waline.js","name":"waline","version":"2.15.8"}}}</script><script type=text/javascript src="/js/main.min.js?=1763785540" defer></script><script type=text/javascript src="/js/clipboard.min.js?=1763785540" defer></script></body></html>